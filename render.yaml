services:
    - type: web
      plan: free
      name: listicle-api
      runtime: node
      rootDir: backend
      buildCommand: |
          npm ci --include=dev
          npx prisma migrate deploy
          npx prisma generate
          npm run build
      startCommand: |
        npm run start
      healthCheckPath: "/healthz"
      envVars:
          - key: DATABASE_URL
            fromDatabase:
                name: listicle-db
                property: connectionString
          - key: PORT
            value: 9000
          - key: NODE_ENV
            value: production
          - key: NODE_VERSION
            value: "24.7.0"
          - key: APP_SECRET
            generateValue: true
          - key: OPENAI_API_KEY
            sync: false
          - key: RESEND_API_KEY
            sync: false
          - key: GOOGLE_CLIENT_ID
            sync: false
          - key: GOOGLE_CLIENT_SECRET
            sync: false
          - key: FACEBOOK_CLIENT_ID
            sync: false
          - key: FACEBOOK_CLIENT_SECRET
            sync: false

databases:
    - name: listicle-db
      databaseName: listicle
      plan: Basic-256mb
      region: oregon
      postgresMajorVersion: 17
